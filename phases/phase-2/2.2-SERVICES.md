# Milestone 2.2: External Services

## Goals
- Set up Spotify API integration
- Set up Genius API integration
- Implement error handling and retries
- Create service tests

## Tasks

### 1. Spotify Service
- [x] Create src/lib/spotify/auth.ts
  - [x] Implement client credentials flow
  - [x] Add error handling
  - [x] Add tests
- [x] Create src/lib/spotify/client.ts
  - [x] Implement playlist search
  - [x] Implement track fetching
  - [x] Add error handling
  - [x] Add tests

### 2. Genius Service
- [ ] Create src/lib/genius/auth.ts
  - [ ] Implement API key authentication
  - [ ] Add error handling
  - [ ] Add tests
- [ ] Create src/lib/genius/client.ts
  - [ ] Implement lyrics search
  - [ ] Add error handling
  - [ ] Add tests

### 3. Error Handling
- [x] Create src/lib/errors.ts
  - [x] Define error classes
  - [x] Add error codes
  - [x] Add error messages

- [x] Implement Error Recovery
  - [x] Add retry strategies
  - [x] Add fallback mechanisms
  - [x] Add logging

### 4. Rate Limiting
- [x] Create src/lib/rate-limit.ts
  - [x] Implement token bucket algorithm
  - [x] Add configurable limits
  - [x] Add queue mechanism

### 5. Testing
- [x] Unit Tests
  - [x] Test error handling
  - [x] Test rate limiting
  - [ ] Test Spotify client
  - [ ] Test Genius client

- [ ] Integration Tests
  - [ ] Test API interactions
  - [ ] Test error recovery
  - [ ] Test rate limiting
  - [ ] Test concurrent requests

- [ ] Mock Services
  - [ ] Create mock responses
  - [ ] Add test utilities
  - [ ] Add fixtures

### 6. Documentation
- [x] API Documentation
  - [x] Document error codes
  - [x] Document recovery strategies
  - [x] Add troubleshooting guide

## Verification
- [x] Spotify authentication works
- [x] Spotify playlist search works
- [x] Spotify track fetching works
- [x] Error handling effective
- [ ] Genius authentication works
- [ ] Genius lyrics search works
- [ ] All tests passing

## Dependencies
```bash
# Already have Spotify SDK
pnpm add axios
pnpm add zod
pnpm add -D jest @types/jest ts-jest
``` 