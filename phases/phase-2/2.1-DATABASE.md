# Milestone 2.1: Database Foundation

## Goals
- [x] Set up Prisma with SQLite
- [x] Implement core database models
- [x] Create and test migrations
- [x] Set up basic database operations

## Tasks

### 1. Initial Setup
- [x] Install dependencies
  ```bash
  pnpm add @prisma/client
  pnpm add -D prisma
  ```
- [x] Initialize Prisma
  ```bash
  pnpm prisma init
  ```
- [x] Configure SQLite database
  - [x] Update DATABASE_URL in .env
  - [x] Set up database file location

### 2. Core Models Implementation
- [x] GameConfig Model
  ```prisma
  model GameConfig {
    id            String   @id @default(uuid())
    date          DateTime @unique
    randomSeed    String
    playlistId    String
    overrideSongId String?
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
    guesses       Guess[]
  }
  ```

- [x] Guess Model
  ```prisma
  model Guess {
    id           String     @id @default(uuid())
    userId       String
    gameConfigId String
    word         String
    timestamp    DateTime   @default(now())
    gameConfig   GameConfig @relation(fields: [gameConfigId], references: [id])
    @@index([userId, gameConfigId])
  }
  ```

### 3. Cache Tables
- [x] CachedSpotifyTrack
  ```prisma
  model CachedSpotifyTrack {
    spotifyId  String   @id
    data       String   // JSON string of full track data
    updatedAt  DateTime @updatedAt
  }
  ```

- [x] CachedSpotifyPlaylist
  ```prisma
  model CachedSpotifyPlaylist {
    spotifyId  String   @id
    data       String   // JSON string of playlist metadata + tracks
    updatedAt  DateTime @updatedAt
  }
  ```

- [x] CachedGeniusLyrics
  ```prisma
  model CachedGeniusLyrics {
    geniusId   String   @id
    spotifyId  String   @unique
    lyrics     String   // Original lyrics text
    updatedAt  DateTime @updatedAt
  }
  ```

### 4. Database Operations
- [x] Create initial migration
  ```bash
  pnpm prisma migrate dev --name init
  ```
- [x] Generate Prisma Client
  ```bash
  pnpm prisma generate
  ```
- [x] Create database utility functions
  - [x] Create src/lib/db.ts
  - [x] Implement singleton pattern for PrismaClient
  - [x] Add basic CRUD operations

### 5. Testing
- [x] Set up test environment
  - [x] Configure test database
  - [x] Create test utilities
- [x] Write model tests
  - [x] Test GameConfig operations
  - [x] Test Guess operations
  - [x] Test cache table operations
- [x] Create seed data script
  - [x] Add example game configs
  - [x] Add example guesses
  - [x] Add example cache data

### 6. Documentation
- [x] Update schema documentation
- [x] Document database operations
- [x] Add example queries
- [x] Document test setup

## Verification
- [x] All models created correctly
- [x] Migrations run successfully
- [x] Prisma Client generated
- [x] Basic CRUD operations working
- [x] Tests passing
- [x] Documentation complete

## Dependencies
```bash
pnpm add @prisma/client
pnpm add -D prisma
``` 