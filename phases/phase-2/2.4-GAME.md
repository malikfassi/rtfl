# Milestone 2.4: Game Logic

## Goals
- Complete game mechanics implementation
- Set up backend game services
- Implement API routes
- Set up input validation
- Implement comprehensive testing framework

## Tasks

### 1. Core Game Logic âœ…
- [x] Word Masking (src/lib/game/masking.ts)
  - [x] Word boundary detection
  - [x] Special character preservation
  - [x] Case-insensitive matching
  - [x] Tests complete

- [x] State Management (src/lib/game/state.ts)
  - [x] Progress calculation
  - [x] Word tracking
  - [x] Win condition checking
  - [x] Tests complete

### 2. Game Testing Framework ðŸ†•
- [ ] Test Framework Setup (src/lib/game/testing.ts)
  - [ ] Define test case interface
  - [ ] Create test helpers
  - [ ] Add test utilities
  - [ ] Document usage

- [ ] Test Scenarios
  - [ ] Word masking scenarios
  - [ ] Progress tracking scenarios
  - [ ] Win condition scenarios
  - [ ] Data hiding scenarios

### 3. API Routes ðŸš§

#### Route Structure Setup âœ…
- [x] Create base route structure
  - [x] Move /admin/games to /games
  - [x] Create necessary subdirectories
  - [x] Set up admin middleware

#### Admin Routes âœ…
- [x] Game Management
  - [x] List Games (GET /admin/games)
  - [x] Get Game (GET /admin/games/:date)
  - [x] Create Game (POST /admin/games/:date)
  - [x] Update Game (PUT /admin/games/:date)
  - [x] Refresh Seed (PUT /admin/games/:date/refresh-seed)

#### Player Routes ðŸš§
- [~] Game Access
  - [x] List Games (GET /games)
  - [~] Get Game State (GET /games/:date)
    - [x] Get game config
    - [x] Include user attempts
    - [x] Include masked content
    - [ ] Progressive data hiding
    - [ ] Conditional Spotify/Genius data reveal
    - [~] Tests complete

  - [~] Submit Guess (POST /games/:date/guess)
    - [x] Validate guess
    - [x] Store guess
    - [x] Compute correctness
    - [ ] Update masking state
    - [~] Tests complete

### 4. Input Processing âœ…
- [x] Request Validation
  - [x] Date format validation
  - [x] Game creation schema
  - [x] Game update schema
  - [x] Guess validation rules
  - [x] Tests

### 5. Testing ðŸš§
- [~] API Tests
  - [x] Admin Routes
  - [~] Player Routes
  - [ ] Spotify Routes
  - [x] Error handling
  - [~] Edge cases

### 6. Documentation
- [ ] API Documentation
  - [ ] Route schemas
  - [ ] Error codes
  - [ ] Examples

- [ ] Technical Documentation
  - [ ] Game flow
  - [ ] Validation rules
  - [ ] Configuration guide
  - [ ] Testing framework usage

## Verification
- [x] Word masking working
- [x] State management working
- [~] API routes implemented
- [~] Tests passing
- [ ] Documentation complete
- [ ] Testing framework implemented

## Future Optimizations
- [ ] Database Optimizations
  - [ ] Add stored procedures for computing guess correctness
  - [ ] Add indexes for common queries
  - [ ] Add caching layer for game statistics

## Dependencies
```bash
pnpm add uuid date-fns
pnpm add -D @types/uuid
``` 