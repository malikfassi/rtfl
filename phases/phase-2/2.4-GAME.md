# Milestone 2.4: Game Logic

## Goals
- Complete game mechanics implementation
- Set up backend game services
- Implement API routes
- Set up input validation

## Tasks

### 1. Core Game Logic âœ…
- [x] Word Masking (src/lib/game/masking.ts)
  - [x] Word boundary detection
  - [x] Special character preservation
  - [x] Case-insensitive matching
  - [x] Tests complete

- [x] State Management (src/lib/game/state.ts)
  - [x] Progress calculation
  - [x] Word tracking
  - [x] Win condition checking
  - [x] Tests complete

### 2. API Routes ðŸš§
- [ ] Game Routes
  - [ ] Public Routes
    - [ ] List Games (GET /games)
      - [ ] Filter sensitive metadata for players
      - [ ] Include user progress if authenticated
    
    - [ ] Get Game (GET /games/:date)
      - [ ] Filter song metadata for players
      - [ ] Include user attempts if authenticated
      - [ ] Return game state
    
    - [ ] Get Game Stats (GET /games/:date/stats)
      - [ ] Compute global statistics
      - [ ] Return stats data
    
    - [ ] Submit Guess (POST /games/:date/guess)
      - [ ] Validate guess
      - [ ] Update game state
      - [ ] Check win condition
      - [ ] Return updated state

  - [ ] Admin Routes
    - [ ] Create Game (POST /games/:date)
      - [ ] Validate date
      - [ ] Create game config
      - [ ] Return created config
    
    - [ ] Update Game (PUT /games/:date)
      - [ ] Update playlist or override song
      - [ ] Return updated config
    
    - [ ] Refresh Seed (PUT /games/:date/refresh-seed)
      - [ ] Generate new random seed
      - [ ] Update game config
      - [ ] Return updated config

    - [ ] Spotify Integration
      - [ ] Search Playlists (GET /spotify/playlists/search)
        - [ ] Query Spotify API
        - [ ] Filter by track count
        - [ ] Return playlist metadata
      
      - [ ] Get Playlist Details (GET /spotify/playlists/:id)
        - [ ] Fetch full playlist data
        - [ ] Include track details
        - [ ] Cache playlist data

### 3. Input Processing
- [ ] Request Validation (src/lib/game/validation.ts)
  - [ ] Word validation rules
  - [ ] Input sanitization
  - [ ] Request schemas
  - [ ] Tests

### 4. Testing
- [ ] API Tests
  - [ ] Public Routes
    - [ ] List games
    - [ ] Get game
    - [ ] Get stats
    - [ ] Submit guess
  - [ ] Admin Routes
    - [ ] Create game
    - [ ] Update game
    - [ ] Refresh seed
  - [ ] Error handling
  - [ ] Edge cases

### 5. Documentation
- [ ] API Documentation
  - [ ] Route schemas
  - [ ] Error codes
  - [ ] Examples

- [ ] Technical Documentation
  - [ ] Game flow
  - [ ] Validation rules
  - [ ] Configuration guide

## Verification
- [x] Word masking working
- [x] State management working
- [ ] API routes implemented
- [ ] Tests passing
- [ ] Documentation complete

## Dependencies
```bash
pnpm add uuid date-fns
pnpm add -D @types/uuid
``` 